ï½ Vue 2 çš„ç»ˆæ­¢æ”¯æŒæ—¶é—´æ˜¯ 2023å¹´12æœˆ31æ—¥ã€‚åœ¨æ­¤ä¹‹åï¼ŒVue 2 åœ¨å·²æœ‰çš„åˆ†å‘æ¸ é“ (å„ç±» CDN å’ŒåŒ…ç®¡ç†å™¨) ä¸­ä»ç„¶å¯ç”¨ï¼Œä½†ä¸å†è¿›è¡Œæ›´æ–°ï¼ŒåŒ…æ‹¬å¯¹å®‰å…¨é—®é¢˜å’Œæµè§ˆå™¨å…¼å®¹æ€§é—®é¢˜çš„ä¿®å¤ç­‰ã€‚

# v2.x ä¸ vue3.0ä¹‹é—´çš„åŒºåˆ«:
åŸºäº Proxy è§‚å¯Ÿè€…æœºåˆ¶ä»¥æ»¡è¶³å…¨è¯­è¨€è¦†ç›–ä»¥åŠæ›´å¥½çš„æ€§èƒ½ï¼›
æ”¾å¼ƒ Object.defineProperty ï¼Œä½¿ç”¨æ›´å¿«çš„åŸç”ŸProxyï¼›
beforeCreate -> è¯·ä½¿ç”¨ setup()
created -> è¯·ä½¿ç”¨ setup()
beforeMount -> onBeforeMount
mounted -> onMounted
beforeUpdate -> onBeforeUpdate
updated -> onUpdated
beforeDestroy -> onBeforeUnmount
destroyed -> onUnmounted

# vue2 æ˜¯ options API  vue3 æ˜¯composition API
options API è€¦åˆåº¦ç›¸å¯¹è¾ƒé«˜  composition API æ ¹æ®é€»è¾‘ç›¸å…³æ€§ç»„ç»‡ä»£ç ï¼Œæé«˜å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§


# v-model
addProp(el, 'value', `(${value})`)
addHandler(el, event, code, null, true)
Object.defindProperty
observer.js æ•°æ®åŠ«æŒ  geter seter
compile.js åˆ¤æ–­å…ƒç´   æ·»åŠ ç›‘å¬æ•°æ®çš„è®¢é˜…è€… æ•°æ®å˜åŒ– æ›´æ–°è¯•å›¾
watcher è®¢é˜…è€… oserver compileä¹‹é—´é€šä¿¡çš„æ¡¥æ¢ å‘å¸ƒè®¢é˜…æ¨¡å¼
mvvm

#v-modelæºç ç²¾é«“  https://ustbhuangyi.github.io/vue-analysis/v2/extend/v-model.html#%E8%A1%A8%E5%8D%95%E5%85%83%E7%B4%A0
addProp(el, 'value', `(${value})`)
addHandler(el, event, code, null, true)

# vue2æ“ä½œæ•°æ®åŸç†
é€šè¿‡Object.defineProperty()æŠŠdataå¯¹è±¡ä¸­æ‰€æœ‰å±æ€§æ·»åŠ åˆ°vmä¸Šã€‚ ä¸ºæ¯ä¸€ä¸ªæ·»åŠ åˆ°vmä¸Šçš„å±æ€§ï¼Œéƒ½æŒ‡å®šä¸€ä¸ªgetter/setterã€‚
åœ¨getter/setterå†…éƒ¨å»æ“ä½œ(è¯»/å†™)dataä¸­å¯¹åº”çš„å±æ€§

tipï¼›åœ¨vue3ä¸­å…è®¸ä½ å†™å¤šä¸ªv-model,è¿™ä¹Ÿæ˜¯å¼ºçƒˆçš„è¯´æ˜äº†ï¼Œv-modelå°±æ˜¯ä¸€ä¸ªè¯­æ³•ç³–ï¼Œåªæ˜¯å¸®ä½ å‡å°‘äº†ä»£ç é‡ï¼Œä»…æ­¤è€Œå·²

# Object.defindProperty å¯¹æ¯” proxy  (https://juejin.cn/post/6844904150560423950)
Object.definePropertyçš„ç¬¬ä¸€ä¸ªç¼ºé™·,æ— æ³•ç›‘å¬æ•°ç»„å˜åŒ–
target ç›®æ ‡å¯¹è±¡ï¼ˆå¯¹è±¡ã€æ•°ç»„ã€å‡½æ•°ï¼‰ handler ä»£ç†å¯¹è±¡ï¼Œå¯ä»¥å¯¹ç›®æ ‡å¯¹è±¡è¿›è¡Œè‡ªå®šä¹‰çš„æ“ä½œ

Object.defineProperty(argu, key, {
                configurable: true,
                enumerable: true,
                get() {
                    console.log(`get ${key} attr`)
                    return value
                },
                set(newValue) {
                    console.log(`set ${key} attr`)
                    value = newValue
                }
            })


# Proxyç”¨æ³•: https://juejin.cn/post/7182084369454989349

### ğŸŒ° 1
let person = {
  name: "Guest"
};

let proxy2 = new Proxy(person, {
  get: function(target, propKey, receiver) {
    console.log(target, propKey, receiver)  // {name: 'Guest'}name: "Guest"[[Prototype]]: Object 'name' Proxy(Object)Â {name: 'Guest'}
    return Reflect.get(target, propKey, receiver)
  }
});

proxy.name // "Guest"

### ğŸŒ° 2
const moment = {
  age: 18,
  address: "è¥¿å®‰",
};

function foo(x, y) {
  return x + y;
}

const proxy = new Proxy(moment, {
  has: function (target, prop) {
    console.log(`ä½¿ç”¨ in è®¿é—®äº† ${prop} æ˜¯å¦å­˜åœ¨äº moment å¯¹è±¡`);
  },
  get: function (target, property, receiver) {
    # property æ˜¯å®ä¾‹å¯¹è±¡çš„key
    console.log(`é€šè¿‡è¯»å– moment å¯¹è±¡ä¸­çš„ ${property} å±æ€§`);
  },
  set: function (target, property, value, receiver) {
    console.log(`é€šè¿‡è®¾ç½® moment å¯¹è±¡ä¸­çš„ ${property} å±æ€§ä¸º ${value}`);
  },
});

const fProxy = new Proxy(foo, {
  apply: function (target, _, params) {
    console.log(target); // [Function: foo]
    console.log(params); //  [ 1, 2 ]
    return target(...params) * 10;
  },
  construct: function (target, argumentsList, newTarget) {
    console.log(target); // [Function: foo]
    console.log(argumentsList); // [ 1, 2 ]
    console.log(newTarget); // [Function: foo]
    return {};
  },
});

"age" in proxy; // ä½¿ç”¨ in è®¿é—®äº† age æ˜¯å¦å­˜åœ¨äº moment å¯¹è±¡
proxy.age; // é€šè¿‡è¯»å– moment å¯¹è±¡ä¸­çš„ age å±æ€§
proxy.address = "è‚‡åº†"; // é€šè¿‡è®¾ç½® moment å¯¹è±¡ä¸­çš„ address å±æ€§ä¸º è‚‡åº†

console.log(foo(1, 2)); // 3
console.log(fProxy(1, 2)); // 30

new fProxy(1, 2);


### ğŸŒ° 3
let user = {
  _name: "Guest",
  get name() {
    return this._name;
  }
};

let userProxy = new Proxy(user, {
  get(target, prop, receiver) {
    return target[prop];
  }
});

let admin = {
  __proto__: userProxy,
  _name: "Admin"
}; 
document.getElementById('common').innerHTML = admin.name  // Guest

let user2 = {
  _name: "Guest",
  get name() {
    return this._name;
  }
};

let userProxy2 = new Proxy(user2, {
  get(target, prop, receiver) {
  #??? userProxy ä»£ç†çš„æ˜¯userå¯¹è±¡ï¼Œæ‰€ä»¥ userProxy ä¸­ getçš„ç¬¬ä¸€ä¸ªå‚æ•° target çš„å€¼å®é™…ä¸Šæ˜¯userï¼Œç»†å“ä¸€ä¸‹,è¿™é‡Œçš„this ä¾æ—§æ˜¯æŒ‡å‘çš„æ˜¯userï¼Œè€Œä¸æ˜¯adminã€‚
    return Reflect.get(target, prop, receiver);
  }
});

let admin2 = {
  __proto__: userProxy2,
  _name: "Admin"
}

document.getElementById('reflect').innerHTML = admin2.name  // Admin


### ğŸŒ° 4 

let api = {
    _apiKey: 'kafakakafaka',
};
const RESTRICTED = ['_apiKey'];
api = new Proxy(api, {
    get(target, key, receiver) {
        if(RESTRICTED.indexOf(key) > -1) {
            throw Error(`${key} ä¸å¯è®¿é—®.`);
        } 
        return Reflect.get(target, key, receiver);
    },
    set(target, key, value, receiver) {
        if(RESTRICTED.indexOf(key) > -1) {
            throw Error(`${key} ä¸å¯ä¿®æ”¹`);
        }
        console.log(target,target._apiKey)
        return Reflect.set(target, key, value, receiver);
    }
});


#! ä»¥ä¸‹æ˜¯ä¸€äº› Reflect å¯¹è±¡çš„å¸¸ç”¨æ–¹æ³•ï¼š

1. Reflect.apply(target, thisArg, argumentsList)
   è°ƒç”¨ä¸€ä¸ªç›®æ ‡å‡½æ•°ï¼Œå¹¶ä¼ é€’ä¸€ä¸ªæŒ‡å®šçš„ this å€¼å’Œå‚æ•°åˆ—è¡¨ã€‚

2. Reflect.construct(target, argumentsList[, newTarget])
   åˆ›å»ºä¸€ä¸ªå®ä¾‹å¯¹è±¡ï¼Œä½¿ç”¨æŒ‡å®šçš„æ„é€ å‡½æ•°å’Œå‚æ•°åˆ—è¡¨ã€‚

3. Reflect.get(target, propertyKey[, receiver])
   è·å–ç›®æ ‡å¯¹è±¡çš„æŒ‡å®šå±æ€§çš„å€¼ã€‚

4. Reflect.set(target, propertyKey, value[, receiver])
   è®¾ç½®ç›®æ ‡å¯¹è±¡çš„æŒ‡å®šå±æ€§çš„å€¼ã€‚
   set(target, propKey, value, receiver)æ–¹æ³•ç”¨æ¥æ‹¦æˆªæŸä¸ªå±æ€§çš„èµ‹å€¼æ“ä½œï¼Œ
   å¯ä»¥æ¥å—å››ä¸ªå‚æ•°ï¼Œä¾æ¬¡ä¸ºç›®æ ‡å¯¹è±¡ã€å±æ€§åã€å±æ€§å€¼å’Œ Proxy å®ä¾‹æœ¬èº«

5. Reflect.has(target, propertyKey)
   åˆ¤æ–­ç›®æ ‡å¯¹è±¡æ˜¯å¦å­˜åœ¨æŒ‡å®šå±æ€§ã€‚

6. Reflect.deleteProperty(target, propertyKey)
   åˆ é™¤ç›®æ ‡å¯¹è±¡çš„æŒ‡å®šå±æ€§ã€‚

7. Reflect.getPrototypeOf(target)
   è·å–ç›®æ ‡å¯¹è±¡çš„åŸå‹å¯¹è±¡ã€‚

8. Reflect.setPrototypeOf(target, prototype)
   è®¾ç½®ç›®æ ‡å¯¹è±¡çš„åŸå‹å¯¹è±¡ã€‚

9. Reflect.ownKeys(target)
   è¿”å›ç›®æ ‡å¯¹è±¡è‡ªèº«çš„æ‰€æœ‰å±æ€§çš„æ•°ç»„ã€‚



#! vue diffç®—æ³•
éœ€æ±‚è€ƒè™‘çš„æƒ…å†µ: 1å±æ€§å˜æ¢ 2å¢åˆ å˜åŒ– 3ä½ç½®å˜åŒ–

; Vue2.X Diff â€”â€” åŒç«¯æ¯”è¾ƒ
Vue.jsä½¿ç”¨äº†ä¸€ç§ç§°ä¸ºVirtual DOMçš„æŠ€æœ¯æ¥æé«˜æ¸²æŸ“æ€§èƒ½ï¼Œè€ŒVirtual DOM çš„å®ç°ä¸»è¦åŸºäºä¸¤ä¸ªç®—æ³•ï¼šdiffç®—æ³•å’Œpatchç®—æ³•ã€‚
å…¶ä¸­ï¼Œdiffç®—æ³•ç”¨äºè®¡ç®—æ–°æ—§è™šæ‹ŸDOMæ ‘çš„å·®å¼‚ï¼Œpatchç®—æ³•åˆ™ç”¨äºå°†è®¡ç®—å‡ºçš„å·®å¼‚åº”ç”¨åˆ°çœŸå®DOMä¸Šã€‚
Vue.jsçš„diffç®—æ³•ä¸»è¦é‡‡ç”¨äº†åŒç«¯æ¯”è¾ƒçš„ç­–ç•¥ã€‚å®ƒé€šè¿‡éå†æ–°æ—§è™šæ‹ŸDOMæ ‘çš„èŠ‚ç‚¹æ¥æ‰¾åˆ°å·®å¼‚ã€‚
å…·ä½“æ¥è¯´ï¼Œç®—æ³•ä¼šåŒæ—¶ä»æ–°æ—§èŠ‚ç‚¹çš„é¦–å°¾ä¸¤ç«¯å¼€å§‹æ¯”è¾ƒï¼Œé€æ­¥å‘ä¸­é—´é æ‹¢ã€‚åœ¨æ¯”è¾ƒè¿‡ç¨‹ä¸­ï¼Œå¦‚æœå‘ç°æ–°æ—§èŠ‚ç‚¹ç›¸åŒï¼Œ
åˆ™ç›´æ¥è¿›å…¥ä¸‹ä¸€ä¸ªèŠ‚ç‚¹çš„æ¯”è¾ƒã€‚å¦‚æœå‘ç°æ–°æ—§èŠ‚ç‚¹ä¸åŒï¼Œåˆ™æ ¹æ®ä¸€å®šçš„ç­–ç•¥ï¼ˆå¦‚èŠ‚ç‚¹çš„keyå±æ€§æˆ–tagåç§°ï¼‰
åˆ¤æ–­æ˜¯è¦åˆ›å»ºã€æ›´æ–°ã€ç§»åŠ¨ã€åˆ é™¤èŠ‚ç‚¹ã€‚æ¯”å¦‚ï¼Œå¦‚æœæ–°èŠ‚ç‚¹çš„keyå€¼ä¸æ—§èŠ‚ç‚¹çš„keyå€¼ç›¸åŒï¼Œåˆ™è¯´æ˜è¿™ä¸¤ä¸ªèŠ‚ç‚¹æ˜¯åŒä¸€ä¸ªèŠ‚ç‚¹ï¼Œ
åªéœ€è¦æ›´æ–°å…¶å†…å®¹å³å¯ã€‚å¦‚æœæ–°èŠ‚ç‚¹çš„keyå€¼åœ¨æ—§èŠ‚ç‚¹ä¸­ä¸å­˜åœ¨ï¼Œåˆ™è¯´æ˜éœ€è¦åˆ›å»ºä¸€ä¸ªæ–°èŠ‚ç‚¹ã€‚å¦‚æœæ–°èŠ‚ç‚¹çš„keyå€¼ä¸æ—§èŠ‚ç‚¹ä¸­çš„å…¶ä»–èŠ‚ç‚¹çš„keyå€¼ç›¸åŒï¼Œ
åˆ™è¯´æ˜éœ€è¦å°†å½“å‰èŠ‚ç‚¹ç§»åŠ¨åˆ°å¯¹åº”èŠ‚ç‚¹çš„ä½ç½®ä¸Šã€‚å¦‚æœå‘ç°æ—§èŠ‚ç‚¹æœ‰ä½†æ–°èŠ‚ç‚¹æ²¡æœ‰ï¼Œåˆ™è¯´æ˜éœ€è¦åˆ é™¤æ—§èŠ‚ç‚¹ã€‚
åœ¨æ¯”è¾ƒå®ŒèŠ‚ç‚¹ä¹‹åï¼Œdiffç®—æ³•ä¼šå¯¹éœ€è¦æ›´æ–°çš„èŠ‚ç‚¹è¿›è¡Œæ›´æ–°æ“ä½œã€‚å…·ä½“æ¥è¯´ï¼ŒVue.jsä¼šæ ¹æ®éœ€è¦æ›´æ–°çš„èŠ‚ç‚¹ä»¥åŠå·®å¼‚ç±»å‹ï¼Œç”Ÿæˆä¸€ç»„é’ˆå¯¹çœŸå®DOMçš„æ“ä½œæŒ‡ä»¤ã€‚è¿™äº›æŒ‡ä»¤åŒ…æ‹¬æ’å…¥èŠ‚ç‚¹ã€åˆ é™¤èŠ‚ç‚¹ã€ç§»åŠ¨èŠ‚ç‚¹ã€æ›´æ–°èŠ‚ç‚¹ç­‰ç­‰ã€‚æœ€åï¼ŒVue.jsé€šè¿‡æ‰§è¡Œè¿™äº›æ“ä½œæŒ‡ä»¤ï¼Œå°†è®¡ç®—å‡ºçš„å·®å¼‚åº”ç”¨åˆ°çœŸå®DOMä¸Šï¼Œå®Œæˆæ¸²æŸ“è¿‡ç¨‹ã€‚
éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œç”±äºdiffç®—æ³•æ˜¯ä¸€ç§è®¡ç®—é‡è¾ƒå¤§çš„ç®—æ³•ï¼Œå› æ­¤Vue.jsä¼šé€šè¿‡ä¸€äº›ä¼˜åŒ–æ‰‹æ®µæ¥æé«˜ç®—æ³•çš„æ€§èƒ½ã€‚ä¾‹å¦‚ï¼ŒVue.jsä¼šç¼“å­˜ä¸€äº›å¸¸ç”¨çš„èŠ‚ç‚¹ã€é™åˆ¶æ¯”è¾ƒçš„æ·±åº¦ã€è·³è¿‡é™æ€èŠ‚ç‚¹ç­‰ç­‰ã€‚è¿™äº›ä¼˜åŒ–æ‰‹æ®µå¯ä»¥æœ‰æ•ˆåœ°å‡å°‘diffç®—æ³•çš„è®¡ç®—é‡ï¼Œæé«˜Vue.jsçš„æ¸²æŸ“æ€§èƒ½ã€‚

Vue3 Diff â€”â€” æœ€é•¿é€’å¢å­åºåˆ—

## é‚£ä¹ˆä¸ºä»€ä¹ˆæœ€é•¿é€’å¢å­åºåˆ—å°±å¯ä»¥ä¿è¯ç§»åŠ¨æ¬¡æ•°æœ€å°‘å‘¢ï¼Ÿ
å› ä¸ºåœ¨ä½ç½®æ•°ç»„ä¸­é€’å¢å°±èƒ½ä¿è¯åœ¨æ—§æ•°ç»„ä¸­çš„ç›¸å¯¹ä½ç½®çš„æœ‰åºæ€§ï¼Œä»è€Œä¸éœ€è¦ç§»åŠ¨ï¼Œå› æ­¤é€’å¢å­åºåˆ—çš„æœ€é•¿å¯ä»¥ä¿è¯ç§»åŠ¨æ¬¡æ•°çš„æœ€å°‘
å¯¹äºå‰é¢çš„å¾—åˆ°çš„ä½ç½®æ•°ç»„[3, 1, 2]ï¼Œå¾—åˆ°æœ€é•¿é€’å¢å­åºåˆ— [1, 2] ï¼Œåœ¨å­åºåˆ—å†…çš„å…ƒç´ ä¸ç§»åŠ¨ï¼Œä¸åœ¨æ­¤å­åºåˆ—çš„å…ƒç´ ç§»åŠ¨å³å¯ã€‚
å¯¹åº”çš„å®é™…çš„èŠ‚ç‚¹å³ d èŠ‚ç‚¹ç§»åŠ¨è‡³b, cå‰é¢å³å¯ã€‚




# ! æ€»ç»“ï¼šï¼šï¼šï¼šï¼šï¼šï¼šï¼šï¼šï¼šï¼šï¼šï¼šï¼šï¼š
vue2ï¼šæ€»çš„æ¥è¯´å°±æ˜¯é€šè¿‡ Object.defineProperty ç›‘å¬å¯¹è±¡çš„æ¯ä¸€ä¸ªå±æ€§ï¼Œå½“è¯»å–æ•°æ®æ—¶ä¼šè§¦å‘ getterï¼Œä¿®æ”¹æ•°æ®æ—¶ä¼šè§¦å‘ setterã€‚
Vue3ï¼šæ˜¯é€šè¿‡ Proxy å¯¹æ•°æ®å®ç° getter/setter ä»£ç†ï¼Œä»è€Œå®ç°å“åº”å¼æ•°æ®

1:ä¸éœ€è¦é€’å½’éå†æ¯ä¸ªå±æ€§ï¼Œæ·»åŠ åŠ«æŒï¼Œæ·±å±‚å¯¹è±¡å±æ€§åªæœ‰åœ¨è®¿é—®çš„æ—¶å€™æ‰è½¬æ¢æˆ Proxy
2:å¯¹æ–°å¢çš„å±æ€§ä¸éœ€è¦å¦å¤–åšåŠ«æŒå¤„ç†
3:ä¸éœ€è¦å¯¹æ•°ç»„çš„æ–¹æ³•è¿›è¡Œé‡å®šä¹‰
ç¼ºç‚¹ï¼šä¸å…¼å®¹ ie

const obj2 = {
    a: 1,
    b: 2
}
const p4 = new Proxy(obj2, {
    defineProperty(target, property, descriptor) {
        return Object.defineProperty(...arguments)
    }
})
Object.defineProperty(p4, 'a', {
    value: 'a'
})
console.log(obj2)


setup() {
        const { proxy } = getCurrentInstance();
        onMounted(() => {
            proxy.$toast.loading({
                message: 'åŠ è½½ä¸­...',
                forbidClick: true,
            })
        });
 
        return {};
    }

# vue3 refä¸­å¯ä»¥æ”¾å¯¹è±¡ä½œä¸ºå‚æ•°å—? reactiveå¯ä»¥æ”¾åŸºç¡€å€¼ä½œä¸ºå‚æ•°å—?
refæ˜¯å¯ä»¥ä¼ å¯¹è±¡çš„, å¦‚æœä¼ çš„æ˜¯å¯¹è±¡ä¼šç»™reactiveå»å®ç°
reactiveæ”¾åŸºç¡€å€¼æ˜¯æ²¡ä»€ä¹ˆä½œç”¨çš„

##! toRef
å¯ä»¥ç”¨æ¥ä¸ºæºå“åº”å¼å¯¹è±¡ä¸Šçš„æŸä¸ª property æ–°åˆ›å»ºä¸€ä¸ª refã€‚ç„¶åï¼Œref å¯ä»¥è¢«ä¼ é€’ï¼Œå®ƒä¼šä¿æŒå¯¹å…¶æº property çš„å“åº”å¼è¿æ¥ã€‚

reactive å‡½æ•°ç”¨äºåˆ›å»ºä¸€ä¸ªå“åº”å¼çš„å¯¹è±¡ã€‚å®ƒæ¥å—ä¸€ä¸ªæ™®é€šçš„ JavaScript å¯¹è±¡ï¼Œå¹¶è¿”å›ä¸€ä¸ªå“åº”å¼çš„ä»£ç†å¯¹è±¡ã€‚
è€Œ toRef å‡½æ•°åˆ™ç”¨äºå°†ä¸€ä¸ªå“åº”å¼å¯¹è±¡çš„å±æ€§è½¬æ¢ä¸ºä¸€ä¸ª ref å¯¹è±¡

```
      let rightReactive = reactive({ name: "NAN" });
      let toRef_rightReactive = toRef(rightReactive, "name");
      console.log(toRef_rightReactive)
```
##! toRefs
å¾ªç¯éå†é€æ¸toRefå³å¯

```
      let rightReactive = reactive({ name: "NAN",address:'wuhan' });
      let toRef_rightReactive = toRef(rightReactive);
      console.log(toRef_rightReactive)
```

# vueç¼–è¯‘å™¨ï¼Œ templateåˆ°renderè¿‡ç¨‹
Vueä¸­æœ‰ä¸ªç‹¬ç‰¹çš„ç¼–è¯‘å™¨æ¨¡å—ï¼Œç§°ä¸ºâ€œcompilerâ€ï¼Œå®ƒçš„ä¸»è¦ä½œç”¨æ˜¯å°†ç”¨æˆ·ç¼–å†™çš„templateç¼–è¯‘ä¸ºjsä¸­å¯æ‰§è¡Œçš„renderå‡½æ•°ã€‚
ä¹‹æ‰€ä»¥éœ€è¦è¿™ä¸ªç¼–è¯‘è¿‡ç¨‹æ˜¯ä¸ºäº†ä¾¿äºå‰ç«¯ç¨‹åºå‘˜èƒ½é«˜æ•ˆçš„ç¼–å†™è§†å›¾æ¨¡æ¿ã€‚ç›¸æ¯”è€Œè¨€ï¼Œ
æˆ‘ä»¬è¿˜æ˜¯æ›´æ„¿æ„ç”¨HTMLæ¥ç¼–å†™è§†å›¾ï¼Œç›´è§‚ä¸”é«˜æ•ˆã€‚æ‰‹å†™renderå‡½æ•°ä¸ä»…æ•ˆç‡åº•ä¸‹ï¼Œè€Œä¸”å¤±å»äº†ç¼–è¯‘æœŸçš„ä¼˜åŒ–èƒ½åŠ›ã€‚

åœ¨Vueä¸­ç¼–è¯‘å™¨ä¼šå…ˆå¯¹templateè¿›è¡Œè§£æï¼Œè¿™ä¸€æ­¥ç§°ä¸ºparseï¼Œ
ç»“æŸä¹‹åä¼šå¾—åˆ°ä¸€ä¸ªJSå¯¹è±¡ï¼Œæˆ‘ä»¬æˆä¸ºæŠ½è±¡è¯­æ³•æ ‘ASTï¼Œç„¶åæ˜¯å¯¹ASTè¿›è¡Œæ·±åŠ å·¥çš„è½¬æ¢è¿‡ç¨‹ï¼Œè¿™ä¸€æ­¥æˆä¸ºtransform
ï¼Œæœ€åå°†å‰é¢å¾—åˆ°çš„ASTç”Ÿæˆä¸ºJSä»£ç ï¼Œä¹Ÿå°±æ˜¯renderå‡½æ•°ã€‚


#vue2ä¸ºä»€ä¹ˆåªèƒ½æœ‰ä¸€ä¸ªæ ¹èŠ‚ç‚¹
å› ä¸ºvdomæ˜¯ä¸€ä¸ªå•æ ¹æ ‘å½¢ç»“æ„æè¿°å½“å‰è§†å›¾ç»“æ„ï¼Œpatchæ–¹æ³•åœ¨éå†çš„æ—¶å€™ä»æ ¹èŠ‚ç‚¹å¼€å§‹éå†ï¼Œå®ƒè¦æ±‚åªæœ‰ä¸€ä¸ªæ ¹èŠ‚ç‚¹ã€‚ç»„ä»¶ä¹Ÿæ˜¯ä¼šè½¬æ¢æˆvdomï¼Œæ‰€ä»¥ä¹Ÿå¿…é¡»æ»¡è¶³å•æ ¹èŠ‚ç‚¹è¦æ±‚

# vue3ä¸ºä»€ä¹ˆå¯ä»¥å¤šæ ¹èŠ‚ç‚¹
å› ä¸ºvue3å¼•å…¥äº†fragmentæ¦‚å¿µï¼Œè¿™æ˜¯ä¸€ä¸ªæŠ½è±¡çš„èŠ‚ç‚¹ï¼Œå¦‚æœå‘ç°ç»„ä»¶æ˜¯å¤šæ ¹çš„ä¼šè‡ªåŠ¨åˆ›å»ºä¸€ä¸ªfragmentèŠ‚ç‚¹ï¼ŒæŠŠå¤šæ ¹èŠ‚ç‚¹è§†ä¸ºè‡ªå·±çš„childrenã€‚åœ¨patchæ—¶ï¼Œå¦‚æœå‘ç°è¿™æ˜¯ä¸€ä¸ªfragmentèŠ‚ç‚¹ï¼Œåˆ™ç›´æ¥éå†childrenåˆ›å»ºæˆ–æ›´æ–°


#teleport
<teleport to="#teleport-target">
  <div v-if="visible" class="toast-wrap">
       <div class="toast-msg">æˆ‘æ˜¯ä¸€ä¸ª Toast æ–‡æ¡ˆ</div>
  </div>
</teleport>


# this.$nextTick åŸç†

æœ¬è´¨æ˜¯å¯¹ JavaScript æ‰§è¡ŒåŸç†EventLoopçš„ä¸€ç§åº”ç”¨ã€‚EventLoopå…¶å®å°±æ˜¯äº‹ä»¶å¾ªç¯
nextTick çš„æ ¸å¿ƒæ˜¯åˆ©ç”¨äº†å¦‚ Promise ã€MutationObserverã€setImmediateã€setTimeoutçš„åŸç”Ÿ JavaScript æ–¹æ³•æ¥æ¨¡æ‹Ÿå¯¹åº”çš„å¾®/å®ä»»åŠ¡çš„å®ç°ï¼Œ
æœ¬è´¨æ˜¯ä¸ºäº†åˆ©ç”¨ JavaScript çš„è¿™äº›å¼‚æ­¥å›è°ƒä»»åŠ¡é˜Ÿåˆ—æ¥å®ç° Vue æ¡†æ¶ä¸­è‡ªå·±çš„å¼‚æ­¥å›è°ƒé˜Ÿåˆ—ã€‚

1ã€varå£°æ˜çš„å˜é‡ï¼Œåœ¨å…¨å±€èŒƒå›´å†…éƒ½æœ‰æ•ˆï¼Œæ‰€ä»¥åœ¨å…¨å±€åªæœ‰ä¸€ä¸ªå˜é‡iï¼Œæ¯ä¸€æ¬¡å¾ªç¯ï¼Œå˜é‡içš„å€¼éƒ½ä¼šå‘ç”Ÿæ”¹å˜ï¼Œè€Œå¾ªç¯å†…éƒ¨ï¼Œè¢«èµ‹ç»™setTimeoutå‡½æ•°å†…éƒ¨çš„iæŒ‡å‘å…¨å±€çš„i,ç»“åˆä¹‹å‰è®²çš„äº‹ä»¶æ‰§è¡Œæœºåˆ¶ï¼Œæœ€åä¸€è½®æ‰“å°çš„iä¹Ÿéƒ½æ˜¯3äº†
2ã€letå£°æ˜çš„å˜é‡ï¼Œletåªåœ¨å—åŠä½œç”¨åŸŸä¸­æœ‰æ•ˆï¼Œå¹¶ä¸”ä¸å­˜åœ¨å˜é‡æå‡ã€‚æ‰€ä»¥æ¯æ¬¡å¾ªç¯åœ¨setTimeoutä¸­çš„iéƒ½æ˜¯ä¸€ä¸ªæ–°çš„å˜é‡ã€‚

ğŸ¤”æ—¢ç„¶æ¯æ¬¡å¾ªç¯çš„iéƒ½æ˜¯ä¸€ä¸ªæ–°å€¼ï¼Œé‚£ä¹ˆç»“æœè¾“å‡ºåº”è¯¥éƒ½æ˜¯åˆå§‹åŒ–å€¼1å‘€ ï¼Ÿ
è¿™æ˜¯å› ä¸ºJavaScriptå¼•æ“å†…éƒ¨ä¼šè®°ä½ä¸Šä¸€è½®å¾ªç¯çš„å€¼ï¼Œåˆå§‹åŒ–æœ¬è½®å˜é‡iæ—¶ï¼Œå°±åœ¨ä¸Šä¸€è½®å¾ªç¯çš„åŸºç¡€ä¸Šè¿›è¡Œè®¡ç®—


å®šä¹‰ï¼šåœ¨ä¸‹æ¬¡DOMæ›´æ–°å¾ªç¯ç»“æŸä¹‹åæ‰§è¡Œçš„å»¶è¿Ÿå›è°ƒã€‚åœ¨ä¿®æ”¹æ•°æ®ä¹‹åç«‹å³ä½¿ç”¨è¯¥æ–¹æ³•ï¼Œè·å–æ›´æ–°åçš„DOMã€‚
åŸç† ï¼šåˆ©ç”¨ Event loop äº‹ä»¶çº¿ç¨‹å»å¼‚æ­¥æ“ä½œ

##  $nextTick  vue2å’Œvue3å¯¹æ¯”

this.$nextTick(() => {
      app = new ModelLoader(
        document.getElementById('modelView')
      )
      // åŠ è½½æ¨¡å‹
      // this.initModel(app);
    })


const handleClick = () => {
  show.value = !show.value;
  console.log(show.value, content.value);   false  ele
  nextTick(() => {
    console.log(show.value, content.value); false null
  });
};

import { ref, nextTick } from 'vue'
const handleClick = async () => {
  show.value = !show.value
  await nextTick().then((e) => {
    console.log(e, "----", show.value, content.value);
  });
  console.log(show.value, content.value)
}





Vue3æ–°ç‰¹æ€§:ï¼šï¼šï¼šï¼šï¼šï¼šï¼šï¼šï¼šï¼šï¼šï¼šï¼šï¼šï¼šï¼šï¼šï¼šï¼šï¼šï¼šï¼š

vue3é€šè¿‡10ä¸ªå®ä¾‹å°ç»ƒä¹ https://github.com/biaochenxuying/blog/issues/63

vbençš„vue3æºç  :https://github1s.com/anncwb/vue-vben-admin

vue3æºç ï¼šhttps://github1s.com/vuejs/core/blob/HEAD/packages/reactivity/src/computed.ts

Proxyä¸ºä»€ä¹ˆè¦é…åˆReflectä½¿ç”¨ï¼šhttps://juejin.cn/post/7080916820353351688


å¿½ç•¥.vueåç¼€
export default defineConfig({     // vite umi??
  resolve: {
    extensions: ['.js', '.ts', '.jsx', '.tsx', '.json', '.vue']
  }
})

å‚è€ƒé“¾æ¥ï¼šhttps://juejin.cn/post/6986838175062687752	


# computed watch åŒºåˆ«ï¼šï¼šï¼šï¼šï¼šï¼šï¼šï¼šï¼šï¼š
computed  æ˜¯è®¡ç®—å±æ€§,ä¾èµ–å…¶å®ƒå±æ€§å€¼ï¼Œå¹¶ä¸” computed çš„å€¼æœ‰ç¼“å­˜,åªæœ‰å®ƒä¾èµ–çš„å±æ€§å€¼å‘ç”Ÿæ”¹å˜,ä¸‹ä¸€æ¬¡è·å– computed çš„å€¼æ—¶æ‰ä¼šé‡æ–°è®¡ç®— computed  çš„å€¼ï¼›
watch æ›´å¤šçš„æ˜¯ã€Œè§‚å¯Ÿã€çš„ä½œç”¨,ç±»ä¼¼äºæŸäº›æ•°æ®çš„ç›‘å¬å›è°ƒ ,æ¯å½“ç›‘å¬çš„æ•°æ®å˜åŒ–æ—¶éƒ½ä¼šæ‰§è¡Œå›è°ƒè¿›è¡Œåç»­æ“ä½œï¼›


# å¼‚æ­¥ç»„ä»¶
// const AsyncCategory = defineAsyncComponent(() => import("./AsyncCategory.vue"))

//   import Loading from './Loading.vue';

//   const AsyncCategory = defineAsyncComponent({
//     loader: () => import("./AsyncCategory.vue"),
//     loadingComponent: Loading,  å ä½ç»„ä»¶ï¼Œå½“AsyncCategoryè¿˜æ²¡åŠ è½½å‡ºæ¥æ—¶å€™ï¼Œæ˜¾ç¤ºè¿™ä¸ªç»„ä»¶
//     errorComponent: å½“AsyncCategoryåŠ è½½å¤±è´¥å‡ºç°
//     delay: 2000, åœ¨æ˜¾ç¤ºloadingComponentç»„ä»¶ä¹‹å‰, ç­‰å¾…å¤šé•¿æ—¶é—´
//     /**
//      * err: é”™è¯¯ä¿¡æ¯,
//      * retry: å‡½æ•°, è°ƒç”¨retryå°è¯•é‡æ–°åŠ è½½
//      * attempts: è®°å½•å°è¯•çš„æ¬¡æ•°
//      */
//     onError: function(err, retry, attempts) {
//     }
//   })



//å†…ç½®ç»„ä»¶  defalultå¯ä»¥æ˜¾ç¤º ä¸å¯ä»¥æ˜¾ç¤ºå°±æ˜¾ç¤ºfallback
// < suspense >
{/* <template #default>
    <async-category></async-category>
  </template>
  <template #fallback>
    <loading></loading>
  </template>
</ > */}

stateï¼šåŒ…å«äº†storeä¸­å­˜å‚¨çš„å„ä¸ªçŠ¶æ€ã€‚
getter: ç±»ä¼¼äº Vue ä¸­çš„è®¡ç®—å±æ€§ï¼Œæ ¹æ®å…¶ä»– getter æˆ– state è®¡ç®—è¿”å›å€¼ã€‚
mutation: ä¸€ç»„æ–¹æ³•ï¼Œæ˜¯æ”¹å˜storeä¸­çŠ¶æ€çš„æ‰§è¡Œè€…ï¼Œåªèƒ½æ˜¯ï¼šåŒæ­¥ï¼šæ“ä½œã€‚
action: ä¸€ç»„æ–¹æ³•ï¼Œå…¶ä¸­å¯ä»¥åŒ…å«å¼‚æ­¥æ“ä½œã€‚ï¼šï¼šï¼š

store.commit('increment')

æƒ³è¦å¼‚æ­¥åœ°æ›´æ”¹çŠ¶æ€ï¼Œå°±éœ€è¦ä½¿ç”¨actionã€‚actionå¹¶ä¸ç›´æ¥æ”¹å˜stateï¼Œè€Œæ˜¯å‘èµ·mutationã€‚
actions: {
    increment (context) {
      context.commit('increment')
    }
  }



æµ…ævue-cliè„šæ‰‹æ¶@vue/cli-serviceæºç ï¼šï¼šï¼šï¼šï¼šï¼šï¼šï¼šï¼šï¼šï¼šï¼šï¼šï¼šï¼šï¼šï¼šï¼š

vue-cliä½¿ç”¨æŒ‡å—ï¼šhttps://cli.vuejs.org/zh/dev-guide/plugin-dev.html

vue create vue-cli-app ------ vue-cli-service build

ä½¿ç”¨npm run script å‘½ä»¤æ—¶,ç›´æ¥ä¼šæ‰¾åˆ°node_modules/.binä¸‹é¢å¯¹åº”çš„è„šæœ¬,windowsç³»ç»Ÿå¯¹åº”vue-cli-service.cmdå‘½ä»¤,ç±»unixç³»ç»Ÿæ˜¯/bin/shå‘½ä»¤
å¼€å§‹æ‰§è¡Œvue-cli-service.js
Serviceå®ä¾‹åŒ–å,åˆåˆ°vue-cli-service.jsä¸­,æ‰§è¡Œservice runæ–¹æ³•
config ä¸‹çš„base.js css.js ç­‰webpacké…ç½®æ¨¡å—éƒ½ä¼šæ‰§è¡ŒchainWebpackæ–¹æ³•,ä»¥baseæ¨¡å—ä¸ºä¾‹
buildæ–¹æ³•ä¼šæ ¹æ®å‘½ä»¤è¡Œå‚æ•°,åŠ è½½ä¸åŒçš„æ¨¡å—æ¥å¤„ç†webpacké…ç½®


# VUE2.6ä½¿ç”¨VueCompositionAPI 
import VueCompositionAPI from '@vue/composition-api'
Vue.use(VueCompositionAPI)


# Vue3ç”¨æ³• https://v3.cn.vuejs.org/

1ï¼šcontext
export default {
  setup(props, context) {
    // Attribute (éå“åº”å¼å¯¹è±¡ï¼Œç­‰åŒäº $attrs)
    console.log(context.attrs)

    // æ’æ§½ (éå“åº”å¼å¯¹è±¡ï¼Œç­‰åŒäº $slots)
    console.log(context.slots)

    // è§¦å‘äº‹ä»¶ (æ–¹æ³•ï¼Œç­‰åŒäº $emit)
    console.log(context.emit)

    // æš´éœ²å…¬å…± property (å‡½æ•°)
    console.log(context.expose)
  }
}

2ï¼šnextTick
å°†å›è°ƒæ¨è¿Ÿåˆ°ä¸‹ä¸€ä¸ª DOM æ›´æ–°å‘¨æœŸä¹‹åæ‰§è¡Œã€‚åœ¨æ›´æ”¹äº†ä¸€äº›æ•°æ®ä»¥ç­‰å¾… DOM æ›´æ–°åç«‹å³ä½¿ç”¨å®ƒã€‚
 setup() {
    const message = ref('Hello!')
    const changeMessage = async newMessage => {
      message.value = newMessage
      await nextTick()
      console.log('Now DOM is updated')
    }
  }

3ï¼šslot
parents.vueï¼š 
 <ModulePopup popupState="module">
      <template v-slot:slotModule>
        <p class="card-header-title">ä¼˜å…ˆæ˜¾ç¤ºæˆ‘</p>
      </template>
    </ModulePopup>
child.vueï¼š
  <slot name="slotModule">
        æˆ‘æ˜¯æ’æ§½ï¼Œçˆ¶ç»„ä»¶æ ‡ç­¾ä¸­æ²¡æœ‰å¡«å†™ä¿¡æ¯ï¼Œæˆ‘å°±æ˜¯é»˜è®¤çš„
      </slot>

slotä¼ å€¼ï¼ˆå­ä¼ çˆ¶ï¼‰ï¼š
child.vue:
 <slot :text="text"
        >æˆ‘æ˜¯ä¼ å€¼æ’æ§½ï¼Œçˆ¶ç»„ä»¶æ ‡ç­¾ä¸­æ²¡æœ‰å¡«å†™ä¿¡æ¯ï¼Œæˆ‘å°±æ˜¯é»˜è®¤çš„</slot
      >

parents.vue:
<ModulePopup popupState="module">
      <template v-slot:default="slotProps">
        <p class="card-header-title">ä¼˜å…ˆå±•ç¤º{{ slotProps }}</p>
      </template>
    </ModulePopup>

slotä¼ å€¼ï¼ˆå­ä¼ çˆ¶ï¼‰ï¼š


4ï¼šemit
çˆ¶ç»„ä»¶ï¼š <emit-child @on-change="emitFn" />
const emitFn = v => {
      console.log(v);
    }
å­ç»„ä»¶: <button @click="clickBtn" class="btn-item">hi~</button>  
const clickBtn = () => {
      ctx.emit("on-change", "hi~");
    };
  
5ï¼šProvide / Inject

6ï¼šå…¶ä»–API
reactive toRefsï¼š 
setup(){
    const data = reactive({
      name: "å°å››",
      age: 18,
      year: computed({
        get: () => {
          return 2020 - data.age;
        },
        set: (val) => {
          data.age = 2020 - val;
        },
      }),
    });
    return {
      ...toRefs(data),//è®²å“åº”å¼çš„å¯¹è±¡å˜ä¸ºæ™®é€šå¯¹è±¡ åœ¨å®¶ã€‚ã€‚ã€‚ç»“æ„ï¼Œåœ¨æ¨¡æ¿ä¸­å°±å¯ä»¥ç›´æ¥ä½¿ç”¨å±æ€§ï¼Œä¸ç”¨data.name
    };
  },
computedï¼š æ¥å—ä¸€ä¸ª getter å‡½æ•°ï¼Œå¹¶æ ¹æ® getter çš„è¿”å›å€¼è¿”å›ä¸€ä¸ªä¸å¯å˜çš„å“åº”å¼ ref å¯¹è±¡ã€‚
watchEffectï¼š ç«‹å³æ‰§è¡Œä¼ å…¥çš„ä¸€ä¸ªå‡½æ•°ï¼ŒåŒæ—¶å“åº”å¼è¿½è¸ªå…¶ä¾èµ–ï¼Œå¹¶åœ¨å…¶ä¾èµ–å˜æ›´æ—¶é‡æ–°è¿è¡Œè¯¥å‡½æ•°ã€‚
watchï¼š
watch(count, (count, prevCount) => {
  /* ... */
})
watch([fooRef, barRef], ([foo, bar], [prevFoo, prevBar]) => {
  /* ... */
})
æƒ°æ€§åœ°æ‰§è¡Œå‰¯ä½œç”¨ï¼›
æ›´å…·ä½“åœ°è¯´æ˜åº”è§¦å‘ä¾¦å¬å™¨é‡æ–°è¿è¡Œçš„çŠ¶æ€ï¼›
è®¿é—®è¢«ä¾¦å¬çŠ¶æ€çš„å…ˆå‰å€¼å’Œå½“å‰å€¼ã€‚
getCurrentInstanceï¼š
getCurrentInstance æ”¯æŒè®¿é—®å†…éƒ¨ç»„ä»¶å®ä¾‹ã€‚
const internalInstance = getCurrentInstance()



##  pinia
https://stackblitz.com/github/piniajs/example-vue-3-vite?file=src%2FApp.vue




# vue2 ç”¨æ³•
<template>
  <div class="hello">
    <button @click="change(value - 1)">-</button>
    <span>{{value}}</span>
    <button @click="change(value + 1)">+</button>
  </div>
</template>

<script>
export default {
  name: "HelloWorld",
  props: {
    value: Number,
  },
  methods: {
    change(val) {
      this.$emit("update:value", val);
    },
  },
};
</script>
å¤åˆ¶ä»£ç 
APP æ¥ä½¿ç”¨
<HelloWorld :value="inputVal" @update:value="inputVal = $event" />
ç­‰æ•ˆäº
<HelloWorld v-model="inputVal" />


<!-- vue2 -->
<Comp :title="inputVal" @update:title="inputVal = $event" />
<!-- ç®€å†™ä¸º -->
<Comp :title.sync="inputVal" />

<!-- vue3 -->
<Comp :title="inputVal" @update:title="inputVal = $event" />
<!-- ç®€å†™ä¸º -->
<Comp v-model:title="inputVal" />



å¤šä¸ªv-model

<ChildComponent v-model:title="pageTitle" v-model:content="pageContent" />

<!-- æ˜¯ä»¥ä¸‹çš„ç®€å†™ï¼š -->

<ChildComponent
  :title="pageTitle"
  @update:title="pageTitle = $event"
  :content="pageContent"
  @update:content="pageContent = $event"
/>



# Nuxt
npx nuxi@latest init <my-project>



## typescript 
yarn add --dev vue-tsc typescript



é™æ€èµ„æºéƒ¨ç½²


ssrå½¢å¼éƒ¨ç½²